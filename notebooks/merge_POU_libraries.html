<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mergeing the POU libraries &mdash; DMS Designer v0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Running the QC checks for the merged POU library" href="run_POU_QC.html" />
    <link rel="prev" title="Generating oligo libraries containing library members for DMS screens" href="library_generation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            DMS Designer
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Example Notebooks:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../notebooks.html">Example Notebooks</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../notebooks.html#library-production">Library production</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../notebooks.html#library-analysis">Library analysis</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Mergeing the POU libraries</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Importing-libraries">Importing libraries</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Defining-library-and-plotting-variables">Defining library and plotting variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Importing-library-1">Importing library 1</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Importing-library-2">Importing library 2</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Importing-library-3">Importing library 3</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Merging-library-1-into-library-2">Merging library 1 into library 2</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Merging-library-3-into-library-2+1">Merging library 3 into library 2+1</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Showing-replicate-replicate-correspondence-within-and-between-replicates">Showing replicate replicate correspondence within and between replicates</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Saving-the-merged-library-for-further-analysis">Saving the merged library for further analysis</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="run_POU_QC.html">Running the QC checks for the merged POU library</a></li>
<li class="toctree-l3"><a class="reference internal" href="create_POU_heatmaps.html">Making variant effect heatmaps for the POU library</a></li>
<li class="toctree-l3"><a class="reference internal" href="OCA_T1_analysis.html">Running a full analysis of the OCA_T1 library</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">DMS_designer</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">DMS Designer</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../notebooks.html">Example Notebooks</a></li>
      <li class="breadcrumb-item active">Mergeing the POU libraries</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/notebooks/merge_POU_libraries.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="admonition note">
<p class="admonition-title">Note</p>
<p>This page was generated from a Jupyter notebook.
<code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">the</span> <span class="pre">notebook</span></code></p>
</div>
<section id="Mergeing-the-POU-libraries">
<h1>Mergeing the POU libraries<a class="headerlink" href="#Mergeing-the-POU-libraries" title="Permalink to this heading"></a></h1>
<section id="Importing-libraries">
<h2>Importing libraries<a class="headerlink" href="#Importing-libraries" title="Permalink to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_palette</span><span class="p">(</span><span class="s1">&#39;colorblind&#39;</span><span class="p">)</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">DMS_designer</span><span class="w"> </span><span class="kn">import</span> <span class="n">Library</span>
</pre></div>
</div>
</div>
</section>
<section id="Defining-library-and-plotting-variables">
<h2>Defining library and plotting variables<a class="headerlink" href="#Defining-library-and-plotting-variables" title="Permalink to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mut_id_regex</span> <span class="o">=</span> <span class="s1">&#39;(?P&lt;Mut_num&gt;\d*)pt_(?P&lt;Position&gt;\d*)(?P&lt;AA&gt;[\w*]*)_v(?P&lt;Version&gt;\d*)&#39;</span>
<span class="n">group_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Position&#39;</span><span class="p">,</span><span class="s1">&#39;AA&#39;</span><span class="p">]</span>
<span class="n">rate_method</span> <span class="o">=</span> <span class="s1">&#39;l2fc&#39;</span>

<span class="n">sheet_name</span> <span class="o">=</span> <span class="s1">&#39;Original_Data&#39;</span>

<span class="n">aa_keys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;R,H,K,D,E,S,T,N,Q,A,V,I,L,M,F,Y,W,C,G,P,*&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))</span>

<span class="n">control_column</span> <span class="o">=</span> <span class="s1">&#39;AA&#39;</span>
<span class="n">positive_values</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;WT&#39;</span><span class="p">]</span>
<span class="n">negative_values</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">]</span>

<span class="c1"># colorscheme = &#39;RdBu&#39;</span>
<span class="c1"># WT_color = &#39;xkcd:violet&#39;</span>

<span class="n">sunset_cmap</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">blend_palette</span><span class="p">([</span><span class="s2">&quot;#5767FE&quot;</span><span class="p">,</span> <span class="s1">&#39;#918AF3&#39;</span><span class="p">,</span><span class="s1">&#39;#D9D6DA&#39;</span> <span class="p">,</span> <span class="s2">&quot;#FFFFCC&quot;</span><span class="p">,</span> <span class="s1">&#39;#FED9A4&#39;</span> <span class="p">,</span><span class="s2">&quot;#FFB077&quot;</span><span class="p">,</span> <span class="s1">&#39;#FF0000&#39;</span><span class="p">],</span><span class="n">as_cmap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># to_red = sns.blend_palette([&#39;#990000&#39;,&#39;#FF0000&#39;,&#39;#FF6666&#39;,&#39;#FFCCCC&#39;, &#39;xkcd:white&#39;][::-1],as_cmap=True)</span>
<span class="n">mutability_cmap</span><span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">blend_palette</span><span class="p">([</span><span class="s2">&quot;#5767FE&quot;</span><span class="p">,</span> <span class="s1">&#39;#918AF3&#39;</span><span class="p">,</span><span class="s1">&#39;#D9D6DA&#39;</span> <span class="p">,</span> <span class="s2">&quot;#FFFFCC&quot;</span><span class="p">,</span> <span class="s1">&#39;#FED9A4&#39;</span> <span class="p">,</span><span class="s2">&quot;#FFB077&quot;</span><span class="p">,</span> <span class="s1">&#39;#FF0000&#39;</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">as_cmap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.colors</span><span class="w"> </span><span class="kn">import</span> <span class="n">TwoSlopeNorm</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">TwoSlopeNorm</span><span class="p">(</span><span class="n">vcenter</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Importing-library-1">
<h2>Importing library 1<a class="headerlink" href="#Importing-library-1" title="Permalink to this heading"></a></h2>
<p>The replicate replicate corespondence for library one looks quite good. We also print a heatmap of library one normalized variant effect scores and position mutability.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">replicates</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;lib1_rep1&#39;</span><span class="p">:[</span><span class="s1">&#39;P0_R1&#39;</span><span class="p">,</span><span class="s1">&#39;P10_R1&#39;</span><span class="p">],</span>
              <span class="s1">&#39;lib1_rep2&#39;</span><span class="p">:[</span><span class="s1">&#39;P0_R2&#39;</span><span class="p">,</span><span class="s1">&#39;P10_R2&#39;</span><span class="p">]}</span>
<span class="n">wt_aa</span> <span class="o">=</span> <span class="s1">&#39;DEPSDLEELEKFAKTFKQRRIKLGFTQGDVGLAMGKLYGNDFSQTTISRFEALNL&#39;</span>
<span class="n">id_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
<span class="n">process_call</span> <span class="o">=</span> <span class="s1">&#39;id&#39;</span>
<span class="n">data_file</span> <span class="o">=</span> <span class="s1">&#39;./library_count_data/POU2F3_1.xlsx&#39;</span>

<span class="n">lib1</span> <span class="o">=</span> <span class="n">Library</span><span class="o">.</span><span class="n">build_from_reads</span><span class="p">(</span><span class="n">data_file</span><span class="p">,</span> <span class="n">replicates</span><span class="p">,</span> <span class="n">id_cols</span><span class="p">,</span> <span class="n">group_cols</span><span class="p">,</span> <span class="n">rate_method</span><span class="p">,</span> <span class="n">aa_keys</span><span class="p">,</span> <span class="n">wt_aa</span><span class="p">,</span> <span class="n">process_call</span><span class="p">,</span> <span class="n">mut_id_regex</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="n">sheet_name</span><span class="p">)</span>


<span class="n">lib1</span><span class="o">.</span><span class="n">make_replicate_checks</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plot_features</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">plot_mutability</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">plot_properties</span> <span class="o">=</span> <span class="kc">False</span>


<span class="n">heatmap_fig</span><span class="p">,</span> <span class="n">axd</span> <span class="o">=</span> <span class="n">lib1</span><span class="o">.</span><span class="n">make_singles_heatmap</span><span class="p">(</span><span class="n">control_col</span><span class="o">=</span><span class="s1">&#39;AA&#39;</span><span class="p">,</span><span class="n">WT_vals</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;WT&#39;</span><span class="p">],</span><span class="n">stop_vals</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">],</span> <span class="n">seq_start</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                       <span class="n">rc_params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;figure.figsize&quot;</span> <span class="p">:</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span> <span class="s1">&#39;figure.dpi&#39;</span><span class="p">:</span><span class="mi">1000</span><span class="p">},</span> <span class="n">grid</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">invert_mutability</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                       <span class="n">thresh</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">main_cmap</span><span class="o">=</span><span class="n">sunset_cmap</span><span class="p">,</span> <span class="n">mutability_cmap</span><span class="o">=</span><span class="n">mutability_cmap</span><span class="p">,</span>
                                       <span class="n">plot_features</span><span class="o">=</span><span class="n">plot_features</span><span class="p">,</span> <span class="n">plot_mutability</span><span class="o">=</span><span class="n">plot_mutability</span><span class="p">,</span> <span class="n">plot_properties</span><span class="o">=</span><span class="n">plot_properties</span><span class="p">,</span>
                                       <span class="n">norm</span><span class="o">=</span><span class="n">norm</span>
                                       <span class="p">)</span>

<span class="n">cbar_width</span> <span class="o">=</span> <span class="mf">0.0135</span>
<span class="n">cbar_height</span> <span class="o">=</span> <span class="mf">0.25</span>
<span class="n">axd</span><span class="p">[</span><span class="s1">&#39;mutant_cmap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
<span class="n">cbar_pos</span> <span class="o">=</span> <span class="n">axd</span><span class="p">[</span><span class="s1">&#39;mutant_cmap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
<span class="n">axd</span><span class="p">[</span><span class="s1">&#39;mutant_cmap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="n">cbar_pos</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cbar_pos</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.11</span><span class="p">,</span> <span class="n">cbar_width</span><span class="p">,</span> <span class="n">cbar_height</span><span class="p">))</span>

<span class="k">if</span> <span class="n">plot_mutability</span><span class="p">:</span>
    <span class="n">axd</span><span class="p">[</span><span class="s1">&#39;mutability_cmap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
    <span class="n">cbar_pos</span> <span class="o">=</span> <span class="n">axd</span><span class="p">[</span><span class="s1">&#39;mutability_cmap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
    <span class="n">axd</span><span class="p">[</span><span class="s1">&#39;mutability_cmap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="n">cbar_pos</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cbar_pos</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cbar_width</span><span class="p">,</span> <span class="n">cbar_pos</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
<span class="k">if</span> <span class="n">plot_properties</span><span class="p">:</span>
    <span class="n">axd</span><span class="p">[</span><span class="s1">&#39;property_cmap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
    <span class="n">cbar_pos</span> <span class="o">=</span> <span class="n">axd</span><span class="p">[</span><span class="s1">&#39;property_cmap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
    <span class="n">axd</span><span class="p">[</span><span class="s1">&#39;property_cmap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="n">cbar_pos</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cbar_pos</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cbar_width</span><span class="p">,</span> <span class="n">cbar_pos</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<br/><br/><br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_merge_POU_libraries_7_0.png" src="../_images/notebooks_merge_POU_libraries_7_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_merge_POU_libraries_7_1.png" src="../_images/notebooks_merge_POU_libraries_7_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_merge_POU_libraries_7_2.png" src="../_images/notebooks_merge_POU_libraries_7_2.png" />
</div>
</div>
</section>
<section id="Importing-library-2">
<h2>Importing library 2<a class="headerlink" href="#Importing-library-2" title="Permalink to this heading"></a></h2>
<p>The replicate replicate corespondence for library two is quite high, but there are differences in scale of effects which we adjust with a linear correction. We also print a heatmap of library two normalized variant effect scores and position mutability.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">replicates</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;lib2_rep1&#39;</span><span class="p">:[</span><span class="s1">&#39;P0_Rep1&#39;</span><span class="p">,</span><span class="s1">&#39;P10_Rep1&#39;</span><span class="p">],</span>
              <span class="s1">&#39;lib2_rep2&#39;</span><span class="p">:[</span><span class="s1">&#39;P0_Rep2&#39;</span><span class="p">,</span><span class="s1">&#39;P10_Rep2&#39;</span><span class="p">]}</span>
<span class="n">wt_aa</span> <span class="o">=</span> <span class="s1">&#39;EALNLSFKNMCKLKPLLEKWLNDAESSPSDPSVSTPSSYPSLSEVFGRKRKKRTSIETNIRLTLEKRFQD&#39;</span>
<span class="n">id_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span>
<span class="n">process_call</span> <span class="o">=</span> <span class="s1">&#39;ID&#39;</span>
<span class="n">data_file</span> <span class="o">=</span> <span class="s1">&#39;./library_count_data/POU2F3_2.xlsx&#39;</span>

<span class="n">lib2</span> <span class="o">=</span> <span class="n">Library</span><span class="o">.</span><span class="n">build_from_reads</span><span class="p">(</span><span class="n">data_file</span><span class="p">,</span> <span class="n">replicates</span><span class="p">,</span> <span class="n">id_cols</span><span class="p">,</span> <span class="n">group_cols</span><span class="p">,</span> <span class="n">rate_method</span><span class="p">,</span> <span class="n">aa_keys</span><span class="p">,</span> <span class="n">wt_aa</span><span class="p">,</span> <span class="n">process_call</span><span class="p">,</span> <span class="n">mut_id_regex</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="n">sheet_name</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Library 2 before replicate rescaling&quot;</span><span class="p">)</span>

<span class="n">lib2</span><span class="o">.</span><span class="n">make_replicate_checks</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Library 2 after replicate rescaling&quot;</span><span class="p">)</span>
<span class="n">lib2</span><span class="p">,</span> <span class="n">fig_pre</span><span class="p">,</span> <span class="n">fig_post</span> <span class="o">=</span> <span class="n">lib2</span><span class="o">.</span><span class="n">rescale_by_replicate_group</span><span class="p">(</span><span class="s1">&#39;lib2_rep2&#39;</span><span class="p">,</span><span class="s1">&#39;lib2_rep1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig_pre</span><span class="o">.</span><span class="n">fig</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig_post</span><span class="o">.</span><span class="n">fig</span><span class="p">)</span>

<span class="n">plot_features</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">plot_mutability</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">plot_properties</span> <span class="o">=</span> <span class="kc">False</span>


<span class="n">heatmap_fig</span><span class="p">,</span> <span class="n">axd</span> <span class="o">=</span> <span class="n">lib2</span><span class="o">.</span><span class="n">make_singles_heatmap</span><span class="p">(</span><span class="n">control_col</span><span class="o">=</span><span class="s1">&#39;AA&#39;</span><span class="p">,</span><span class="n">WT_vals</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;WT&#39;</span><span class="p">],</span><span class="n">stop_vals</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">],</span> <span class="n">seq_start</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                       <span class="n">rc_params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;figure.figsize&quot;</span> <span class="p">:</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span> <span class="s1">&#39;figure.dpi&#39;</span><span class="p">:</span><span class="mi">1000</span><span class="p">},</span> <span class="n">grid</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">invert_mutability</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                       <span class="n">thresh</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">main_cmap</span><span class="o">=</span><span class="n">sunset_cmap</span><span class="p">,</span> <span class="n">mutability_cmap</span><span class="o">=</span><span class="n">mutability_cmap</span><span class="p">,</span>
                                       <span class="n">plot_features</span><span class="o">=</span><span class="n">plot_features</span><span class="p">,</span> <span class="n">plot_mutability</span><span class="o">=</span><span class="n">plot_mutability</span><span class="p">,</span> <span class="n">plot_properties</span><span class="o">=</span><span class="n">plot_properties</span><span class="p">,</span>
                                       <span class="n">norm</span><span class="o">=</span><span class="n">norm</span>
                                       <span class="p">)</span>

<span class="n">cbar_width</span> <span class="o">=</span> <span class="mf">0.0135</span>
<span class="n">cbar_height</span> <span class="o">=</span> <span class="mf">0.25</span>
<span class="n">axd</span><span class="p">[</span><span class="s1">&#39;mutant_cmap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
<span class="n">cbar_pos</span> <span class="o">=</span> <span class="n">axd</span><span class="p">[</span><span class="s1">&#39;mutant_cmap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
<span class="n">axd</span><span class="p">[</span><span class="s1">&#39;mutant_cmap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="n">cbar_pos</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cbar_pos</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.11</span><span class="p">,</span> <span class="n">cbar_width</span><span class="p">,</span> <span class="n">cbar_height</span><span class="p">))</span>

<span class="k">if</span> <span class="n">plot_mutability</span><span class="p">:</span>
    <span class="n">axd</span><span class="p">[</span><span class="s1">&#39;mutability_cmap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
    <span class="n">cbar_pos</span> <span class="o">=</span> <span class="n">axd</span><span class="p">[</span><span class="s1">&#39;mutability_cmap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
    <span class="n">axd</span><span class="p">[</span><span class="s1">&#39;mutability_cmap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="n">cbar_pos</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cbar_pos</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cbar_width</span><span class="p">,</span> <span class="n">cbar_pos</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
<span class="k">if</span> <span class="n">plot_properties</span><span class="p">:</span>
    <span class="n">axd</span><span class="p">[</span><span class="s1">&#39;property_cmap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
    <span class="n">cbar_pos</span> <span class="o">=</span> <span class="n">axd</span><span class="p">[</span><span class="s1">&#39;property_cmap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
    <span class="n">axd</span><span class="p">[</span><span class="s1">&#39;property_cmap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="n">cbar_pos</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cbar_pos</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cbar_width</span><span class="p">,</span> <span class="n">cbar_pos</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Library 2 before replicate rescaling
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_merge_POU_libraries_9_1.png" src="../_images/notebooks_merge_POU_libraries_9_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_merge_POU_libraries_9_2.png" src="../_images/notebooks_merge_POU_libraries_9_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Library 2 after replicate rescaling
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_merge_POU_libraries_9_4.png" src="../_images/notebooks_merge_POU_libraries_9_4.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_merge_POU_libraries_9_5.png" src="../_images/notebooks_merge_POU_libraries_9_5.png" />
</div>
</div>
</section>
<section id="Importing-library-3">
<h2>Importing library 3<a class="headerlink" href="#Importing-library-3" title="Permalink to this heading"></a></h2>
<p>The replicate replicate corespondence for library three looks quite good. We also print a heatmap of library three normalized variant effect scores and position mutability.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">replicates</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;lib3_rep1&#39;</span><span class="p">:[</span><span class="s1">&#39;P0_Rep1&#39;</span><span class="p">,</span><span class="s1">&#39;P10_Rep1&#39;</span><span class="p">],</span>
              <span class="s1">&#39;lib3_rep2&#39;</span><span class="p">:[</span><span class="s1">&#39;P0_Rep2&#39;</span><span class="p">,</span><span class="s1">&#39;P10_Rep2&#39;</span><span class="p">]}</span>
<span class="n">wt_aa</span> <span class="o">=</span> <span class="s1">&#39;RFQDNPKPSSEEISMIAEQLSMEKEVVRVWFCNRRQKEKRINCPVATPIKPPVYN&#39;</span>
<span class="n">id_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span>
<span class="n">process_call</span> <span class="o">=</span> <span class="s1">&#39;ID&#39;</span>
<span class="n">data_file</span> <span class="o">=</span> <span class="s1">&#39;./library_count_data/POU2F3_3.xlsx&#39;</span>

<span class="n">lib3</span> <span class="o">=</span> <span class="n">Library</span><span class="o">.</span><span class="n">build_from_reads</span><span class="p">(</span><span class="n">data_file</span><span class="p">,</span> <span class="n">replicates</span><span class="p">,</span> <span class="n">id_cols</span><span class="p">,</span> <span class="n">group_cols</span><span class="p">,</span> <span class="n">rate_method</span><span class="p">,</span> <span class="n">aa_keys</span><span class="p">,</span> <span class="n">wt_aa</span><span class="p">,</span> <span class="n">process_call</span><span class="p">,</span> <span class="n">mut_id_regex</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="n">sheet_name</span><span class="p">)</span>


<span class="n">lib3</span><span class="o">.</span><span class="n">make_replicate_checks</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plot_features</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">plot_mutability</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">plot_properties</span> <span class="o">=</span> <span class="kc">False</span>


<span class="n">heatmap_fig</span><span class="p">,</span> <span class="n">axd</span> <span class="o">=</span> <span class="n">lib3</span><span class="o">.</span><span class="n">make_singles_heatmap</span><span class="p">(</span><span class="n">control_col</span><span class="o">=</span><span class="s1">&#39;AA&#39;</span><span class="p">,</span><span class="n">WT_vals</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;WT&#39;</span><span class="p">],</span><span class="n">stop_vals</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">],</span> <span class="n">seq_start</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                       <span class="n">rc_params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;figure.figsize&quot;</span> <span class="p">:</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span> <span class="s1">&#39;figure.dpi&#39;</span><span class="p">:</span><span class="mi">1000</span><span class="p">},</span> <span class="n">grid</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">invert_mutability</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                       <span class="n">thresh</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">main_cmap</span><span class="o">=</span><span class="n">sunset_cmap</span><span class="p">,</span> <span class="n">mutability_cmap</span><span class="o">=</span><span class="n">mutability_cmap</span><span class="p">,</span>
                                       <span class="n">plot_features</span><span class="o">=</span><span class="n">plot_features</span><span class="p">,</span> <span class="n">plot_mutability</span><span class="o">=</span><span class="n">plot_mutability</span><span class="p">,</span> <span class="n">plot_properties</span><span class="o">=</span><span class="n">plot_properties</span><span class="p">,</span>
                                       <span class="n">norm</span><span class="o">=</span><span class="n">norm</span>
                                       <span class="p">)</span>

<span class="n">cbar_width</span> <span class="o">=</span> <span class="mf">0.0135</span>
<span class="n">cbar_height</span> <span class="o">=</span> <span class="mf">0.25</span>
<span class="n">axd</span><span class="p">[</span><span class="s1">&#39;mutant_cmap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
<span class="n">cbar_pos</span> <span class="o">=</span> <span class="n">axd</span><span class="p">[</span><span class="s1">&#39;mutant_cmap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
<span class="n">axd</span><span class="p">[</span><span class="s1">&#39;mutant_cmap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="n">cbar_pos</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cbar_pos</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.11</span><span class="p">,</span> <span class="n">cbar_width</span><span class="p">,</span> <span class="n">cbar_height</span><span class="p">))</span>

<span class="k">if</span> <span class="n">plot_mutability</span><span class="p">:</span>
    <span class="n">axd</span><span class="p">[</span><span class="s1">&#39;mutability_cmap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
    <span class="n">cbar_pos</span> <span class="o">=</span> <span class="n">axd</span><span class="p">[</span><span class="s1">&#39;mutability_cmap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
    <span class="n">axd</span><span class="p">[</span><span class="s1">&#39;mutability_cmap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="n">cbar_pos</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cbar_pos</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cbar_width</span><span class="p">,</span> <span class="n">cbar_pos</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
<span class="k">if</span> <span class="n">plot_properties</span><span class="p">:</span>
    <span class="n">axd</span><span class="p">[</span><span class="s1">&#39;property_cmap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
    <span class="n">cbar_pos</span> <span class="o">=</span> <span class="n">axd</span><span class="p">[</span><span class="s1">&#39;property_cmap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
    <span class="n">axd</span><span class="p">[</span><span class="s1">&#39;property_cmap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="n">cbar_pos</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cbar_pos</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cbar_width</span><span class="p">,</span> <span class="n">cbar_pos</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<br/><br/><br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_merge_POU_libraries_11_0.png" src="../_images/notebooks_merge_POU_libraries_11_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_merge_POU_libraries_11_1.png" src="../_images/notebooks_merge_POU_libraries_11_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_merge_POU_libraries_11_2.png" src="../_images/notebooks_merge_POU_libraries_11_2.png" />
</div>
</div>
</section>
<section id="Merging-library-1-into-library-2">
<h2>Merging library 1 into library 2<a class="headerlink" href="#Merging-library-1-into-library-2" title="Permalink to this heading"></a></h2>
<p>Since library 1 and library 2 share a small number of variants which are almost all in the bottom mode of the fitness distribution, we cannot align library scores using all the overlapping variants. Instead we correct the scores using the positive and negative controls.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lib1</span><span class="o">.</span><span class="n">id_cols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span>
<span class="n">lib1</span><span class="o">.</span><span class="n">data_df</span> <span class="o">=</span> <span class="n">lib1</span><span class="o">.</span><span class="n">data_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="s1">&#39;ID&#39;</span><span class="p">},</span><span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">lib_merged</span><span class="p">,</span> <span class="n">fig_pre</span><span class="p">,</span> <span class="n">fig_post</span> <span class="o">=</span> <span class="n">Library</span><span class="o">.</span><span class="n">merge_by_overlap</span><span class="p">(</span><span class="n">lib2</span><span class="p">,</span><span class="n">lib1</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">lib1</span><span class="o">.</span><span class="n">WT_seq</span><span class="o">+</span><span class="n">lib2</span><span class="o">.</span><span class="n">WT_seq</span><span class="p">[</span><span class="mi">5</span><span class="p">:],</span> <span class="n">control_col</span><span class="o">=</span><span class="s1">&#39;AA&#39;</span><span class="p">,</span><span class="n">control_val</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;WT&#39;</span><span class="p">,</span><span class="s1">&#39;*&#39;</span><span class="p">],</span><span class="n">automatically_rescale_by_controls</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="s2">&quot;Library controls before merge&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">fig_pre</span><span class="o">.</span><span class="n">fig</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig_pre</span><span class="o">.</span><span class="n">fig</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="s2">&quot;Library controls after merge&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">fig_post</span><span class="o">.</span><span class="n">fig</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig_post</span><span class="o">.</span><span class="n">fig</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/jackdesmarais/miniconda3/envs/DMS_Designer/lib/python3.9/site-packages/statsmodels/regression/linear_model.py:1717: RuntimeWarning: divide by zero encountered in scalar divide
  return np.dot(wresid, wresid) / self.df_resid
/Users/jackdesmarais/miniconda3/envs/DMS_Designer/lib/python3.9/site-packages/statsmodels/regression/linear_model.py:1717: RuntimeWarning: divide by zero encountered in scalar divide
  return np.dot(wresid, wresid) / self.df_resid
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;Library controls before merge&#39;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_merge_POU_libraries_13_2.png" src="../_images/notebooks_merge_POU_libraries_13_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;Library controls after merge&#39;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_merge_POU_libraries_13_4.png" src="../_images/notebooks_merge_POU_libraries_13_4.png" />
</div>
</div>
</section>
<section id="Merging-library-3-into-library-2+1">
<h2>Merging library 3 into library 2+1<a class="headerlink" href="#Merging-library-3-into-library-2+1" title="Permalink to this heading"></a></h2>
<p>Since library 3 and library 2 share a large number of variants which span the fitness distribution, we can align library scores using all the overlapping variants.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lib_merged</span><span class="p">,</span> <span class="n">fig_pre</span><span class="p">,</span> <span class="n">fig_post</span> <span class="o">=</span> <span class="n">Library</span><span class="o">.</span><span class="n">merge_by_overlap</span><span class="p">(</span><span class="n">lib_merged</span><span class="p">,</span><span class="n">lib3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">116</span><span class="p">,</span> <span class="n">lib_merged</span><span class="o">.</span><span class="n">WT_seq</span><span class="o">+</span><span class="n">lib3</span><span class="o">.</span><span class="n">WT_seq</span><span class="p">[</span><span class="mi">4</span><span class="p">:],</span><span class="n">automatically_rescale_linearly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="s2">&quot;Library overlapping variants before merge&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">fig_pre</span><span class="o">.</span><span class="n">fig</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig_pre</span><span class="o">.</span><span class="n">fig</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="s2">&quot;Library overlapping variants after merge&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">fig_post</span><span class="o">.</span><span class="n">fig</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig_post</span><span class="o">.</span><span class="n">fig</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;Library overlapping variants before merge&#39;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_merge_POU_libraries_15_1.png" src="../_images/notebooks_merge_POU_libraries_15_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;Library overlapping variants after merge&#39;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_merge_POU_libraries_15_3.png" src="../_images/notebooks_merge_POU_libraries_15_3.png" />
</div>
</div>
</section>
<section id="Showing-replicate-replicate-correspondence-within-and-between-replicates">
<h2>Showing replicate replicate correspondence within and between replicates<a class="headerlink" href="#Showing-replicate-replicate-correspondence-within-and-between-replicates" title="Permalink to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lib_merged</span><span class="o">.</span><span class="n">make_replicate_checks</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_merge_POU_libraries_17_0.png" src="../_images/notebooks_merge_POU_libraries_17_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_merge_POU_libraries_17_1.png" src="../_images/notebooks_merge_POU_libraries_17_1.png" />
</div>
</div>
</section>
<section id="Saving-the-merged-library-for-further-analysis">
<h2>Saving the merged library for further analysis<a class="headerlink" href="#Saving-the-merged-library-for-further-analysis" title="Permalink to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lib_merged</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;./output/libraries/POU2F3_merged.pkl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="library_generation.html" class="btn btn-neutral float-left" title="Generating oligo libraries containing library members for DMS screens" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="run_POU_QC.html" class="btn btn-neutral float-right" title="Running the QC checks for the merged POU library" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, John J Desmarais.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>